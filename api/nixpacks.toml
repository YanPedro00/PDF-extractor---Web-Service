[phases.setup]
nixPkgs = ["python313"]
aptPkgs = ["libgl1", "libglib2.0-0"]

[phases.install]
cmds = [
  "chmod +x install_system_deps.sh && ./install_system_deps.sh || true",
  "python3 -m pip install --upgrade pip",
  "pip uninstall -y opencv-python opencv-contrib-python opencv-python-headless || true",
  "pip install --no-cache-dir opencv-contrib-python-headless>=4.8.0",
  "pip install -r requirements.txt",
  "pip uninstall -y opencv-python opencv-contrib-python || true",
  "python3 download_models.py"
]

[start]
cmd = "python3 pdf_ocr_api.py"

# Vari√°veis de ambiente para OpenCV funcionar sem GUI (headless)
[variables]
PORT = "5003"
OPENCV_IO_ENABLE_OPENEXR = "0"
QT_QPA_PLATFORM = "offscreen"
OPENCV_HEADLESS = "1"
OPENCV_AVOID_OPENGL = "1"
OPENCV_SKIP_OPENCL = "1"
DISPLAY = ":99"

