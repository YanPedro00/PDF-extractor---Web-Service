[phases.setup]
nixPkgs = ["python313"]

[phases.install]
cmds = [
  "python3 -m pip install --upgrade pip",
  "pip uninstall -y opencv-python opencv-contrib-python || true",
  "pip install opencv-python-headless>=4.8.0",
  "pip install -r requirements.txt",
  "python3 download_models.py"
]

[start]
cmd = "python3 pdf_ocr_api.py"

# Vari√°veis de ambiente para OpenCV funcionar sem GUI (headless)
[variables]
PORT = "5003"
OPENCV_IO_ENABLE_OPENEXR = "0"
QT_QPA_PLATFORM = "offscreen"
OPENCV_HEADLESS = "1"
DISPLAY = ":99"

